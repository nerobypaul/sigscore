## 12:00 — Add supertest-based integration tests for backend API

**Task:** Write E2E integration tests using supertest that exercise the full Express request-response lifecycle with mocked Prisma.

**Changes:**
- backend/src/app.ts — New file. Extracted Express app setup from index.ts so it can be imported by supertest without triggering app.listen(). Also mounted the previously-unmounted api-keys route.
- backend/src/index.ts — Refactored to import app from app.ts and only handle server startup.
- backend/src/__tests__/integration/setup.ts — Shared integration test setup: mocks logger, config (with high rate limits for tests), and a deeply-mockable Prisma singleton.
- backend/src/__tests__/integration/helpers.ts — Integration test helpers: real JWT token generation (matching the mocked config secrets), auth header builders, and reusable mock data factories.
- backend/src/__tests__/integration/auth.integration.test.ts — 15 tests covering register, login, refresh, me (protected), and logout flows including validation, expired tokens, and missing headers.
- backend/src/__tests__/integration/contacts.integration.test.ts — 14 tests covering CRUD operations, validation (missing fields, invalid email/URL), auth requirements, and organization scoping.
- backend/src/__tests__/integration/companies.integration.test.ts — 12 tests covering CRUD operations, validation (missing name, invalid enum/email/URL), and auth requirements.
- backend/src/__tests__/integration/deals.integration.test.ts — 15 tests covering CRUD operations, validation (all 9 PLG stages, probability bounds, invalid stage), and auth requirements.
- backend/src/__tests__/integration/api-keys.integration.test.ts — 13 tests covering API key create/list/revoke/delete, validation, API key header auth behavior, and organization access control.

**Decisions:**
- Extracted app.ts from index.ts to avoid port binding during test imports. This is a standard pattern for supertest-based testing.
- Mounted /api/v1/api-keys route which existed as a route file but was never registered in the Express app.
- Used real JWT token generation (jsonwebtoken) with the same secrets as the mocked config, rather than mocking JWT utilities, to exercise the real auth middleware chain.
- Mocked Prisma at the database level but let all middleware (auth, validation, error handling, rate limiting) run for real.
- Set rate limit max to 10000 in test config to avoid interference during rapid test execution.

**Open questions:**
- None

**Status:** completed
