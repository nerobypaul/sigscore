## 17:30 — P0 Error Handling + Organization CRUD

**Task:** Add AppError class for structured error handling, update all services to use it, add Organization CRUD endpoints.

**Changes:**
- backend/src/utils/errors.ts -- New file. AppError class extending Error with statusCode and isOperational fields. Used across all services for consistent HTTP error responses.
- backend/src/middleware/error.ts -- Added AppError import and instanceof check before the 500 fallback, so AppError instances return their correct statusCode.
- backend/src/services/contacts.ts -- Replaced `throw new Error('Contact not found')` with `throw new AppError('Contact not found', 404)` in update and delete.
- backend/src/services/companies.ts -- Same pattern: 404 for not found in update and delete.
- backend/src/services/deals.ts -- Same pattern: 404 for not found in update and delete.
- backend/src/services/activities.ts -- Same pattern: 404 for not found in update and delete.
- backend/src/services/signal-sources.ts -- 404 for not found in delete and test.
- backend/src/services/webhooks.ts -- 404 for not found in delete.
- backend/src/services/custom-objects.ts -- Replaced SchemaNotFoundError with AppError(msg, 404), SchemaConflictError with AppError(msg, 409), RecordValidationError with AppError(msg, 400). Old custom error classes kept but no longer thrown.
- backend/src/controllers/custom-objects.ts -- Removed imports and catch-block references to SchemaNotFoundError, SchemaConflictError, RecordValidationError since AppError is now handled by the error middleware.
- backend/src/services/organizations.ts -- New file. CRUD service: createOrganization (creates org + OWNER membership), getOrganizations (list user's orgs), getOrganization (verify membership), updateOrganization (verify OWNER/ADMIN role).
- backend/src/controllers/organizations.ts -- New file. Express controller with create, list, get, update handlers following existing codebase patterns.
- backend/src/routes/organizations.ts -- New file. POST /, GET /, GET /:id, PUT /:id with authenticate middleware and Zod validation.
- backend/src/app.ts -- Imported and mounted organizationRoutes at /api/v1/organizations after auth routes.

**Decisions:**
- AppError is intentionally simple (statusCode + isOperational) rather than adding error codes or categories -- YAGNI for now, easy to extend later.
- Organization routes use only authenticate middleware (not requireOrganization) since the user is managing orgs themselves, not acting within one.
- Slug uniqueness is enforced at the service layer with a 409 conflict error rather than relying solely on the DB unique constraint.
- Kept the old custom error classes in custom-objects.ts (SchemaNotFoundError etc.) since removing them would be a breaking change if anything external references them.

**Open questions:**
- None

**Status:** completed

---

## 16:00 — P0 Performance and Docker improvements

**Task:** Batch signal ingest with prisma.$transaction, add Redis to Docker, add composite indexes to Prisma schema.

**Changes:**
- backend/src/services/signals.ts — Rewrote `ingestSignalBatch` to use `prisma.$transaction(async (tx) => { ... })` interactive transaction. All account resolution (actorId -> companyId, anonymousId -> domain lookups) and signal creates now happen atomically within a single transaction. On failure, all signals roll back and every input is reported as failed.
- docker-compose.yml — Added Redis 7 Alpine service with AOF persistence, healthcheck, and named volume. Added `REDIS_HOST` and `REDIS_PORT` environment variables to backend service. Added redis to backend's `depends_on` with `condition: service_healthy`. Added `redis_data` named volume.
- backend/prisma/schema.prisma — Added 8 composite indexes for common query patterns:
  - Signal: `[organizationId, type, timestamp desc]`, `[organizationId, sourceId, timestamp desc]`
  - Contact: `[organizationId, lastName]`, `[organizationId, createdAt desc]`
  - Company: `[organizationId, name]`, `[organizationId, createdAt desc]`
  - Deal: `[organizationId, stage, createdAt desc]`
  - Activity: `[organizationId, type, status]`

**Decisions:**
- Used interactive transaction (`prisma.$transaction(async (tx) => {...})`) rather than batched array transaction because account resolution requires async lookups (contact.findFirst, company.findFirst) before each signal.create.
- Transaction is all-or-nothing: if any signal in the batch fails (e.g. FK violation), the entire batch rolls back and all inputs are reported as failed. This is the correct atomicity guarantee for batch ingestion.
- Did not run `prisma migrate` — schema changes only. Migrations will be generated separately.
- Existing single-column indexes were preserved alongside the new composites; PostgreSQL will use whichever index the query planner deems most selective.

**Open questions:**
- None

**Status:** completed

---

## 14:30 — Add OpenAPI/Swagger documentation for all REST endpoints

**Task:** Add comprehensive OpenAPI 3.0 documentation to the backend API with Swagger UI.

**Changes:**
- backend/package.json — Added swagger-jsdoc dependency and @types/swagger-jsdoc devDependency.
- backend/src/config/swagger.ts — New file. OpenAPI 3.0.3 spec configuration with swagger-jsdoc, defining 33 component schemas (all CRM entities, request/response bodies, pagination, errors), 2 security schemes (BearerAuth JWT, ApiKeyAuth), shared parameters (OrganizationId, Page, Limit), and 9 tag groups.
- backend/src/routes/auth.ts — Added @openapi JSDoc annotations for all 5 auth endpoints (register, login, refresh, logout, me) with exact request/response schemas.
- backend/src/routes/contacts.ts — Added @openapi JSDoc annotations for all 5 CRUD endpoints with pagination, search, and company filter parameters.
- backend/src/routes/companies.ts — Added @openapi JSDoc annotations for all 5 CRUD endpoints with search and industry filter parameters.
- backend/src/routes/deals.ts — Added @openapi JSDoc annotations for all 5 CRUD endpoints with stage/owner/company filter parameters and PLG pipeline stages.
- backend/src/routes/activities.ts — Added @openapi JSDoc annotations for all 5 CRUD endpoints with type/status/user/contact/company/deal filter parameters.
- backend/src/routes/api-keys.ts — Added @openapi JSDoc annotations for all 4 endpoints (list, create, revoke, delete) noting JWT-only auth requirement.
- backend/src/routes/signals.ts — Added @openapi JSDoc annotations for all 8 endpoints (ingest, batch ingest, query, top accounts, account signals, timeline, get score, compute score).
- backend/src/routes/webhooks.ts — Added @openapi JSDoc annotations for all 3 endpoints (list, create, delete).
- backend/src/routes/signal-sources.ts — Added @openapi JSDoc annotations for all 6 endpoints (list, get, create, update, delete, test).
- backend/src/app.ts — Imported swaggerSpec; added GET /api-docs.json and GET /api/openapi.json for raw JSON spec; mounted Swagger UI at both /api-docs (primary) and /api/docs (legacy).
- backend/src/index.ts — Updated startup log to show /api-docs and /api-docs.json URLs.

**Decisions:**
- Kept /api/docs (legacy) alongside /api-docs (requested) for backward compatibility.
- Schemas mirror the exact Prisma models and service return shapes (verified by reading every controller + service + Prisma schema).
- Auth endpoints use no security scheme in the spec (they are public); all CRM/Signal endpoints list both BearerAuth and ApiKeyAuth as alternatives.
- API Key management endpoints only list BearerAuth since they require JWT (not API key auth).

**Open questions:**
- None

**Status:** completed

---

## 12:00 — Add supertest-based integration tests for backend API

**Task:** Write E2E integration tests using supertest that exercise the full Express request-response lifecycle with mocked Prisma.

**Changes:**
- backend/src/app.ts — New file. Extracted Express app setup from index.ts so it can be imported by supertest without triggering app.listen(). Also mounted the previously-unmounted api-keys route.
- backend/src/index.ts — Refactored to import app from app.ts and only handle server startup.
- backend/src/__tests__/integration/setup.ts — Shared integration test setup: mocks logger, config (with high rate limits for tests), and a deeply-mockable Prisma singleton.
- backend/src/__tests__/integration/helpers.ts — Integration test helpers: real JWT token generation (matching the mocked config secrets), auth header builders, and reusable mock data factories.
- backend/src/__tests__/integration/auth.integration.test.ts — 15 tests covering register, login, refresh, me (protected), and logout flows including validation, expired tokens, and missing headers.
- backend/src/__tests__/integration/contacts.integration.test.ts — 14 tests covering CRUD operations, validation (missing fields, invalid email/URL), auth requirements, and organization scoping.
- backend/src/__tests__/integration/companies.integration.test.ts — 12 tests covering CRUD operations, validation (missing name, invalid enum/email/URL), and auth requirements.
- backend/src/__tests__/integration/deals.integration.test.ts — 15 tests covering CRUD operations, validation (all 9 PLG stages, probability bounds, invalid stage), and auth requirements.
- backend/src/__tests__/integration/api-keys.integration.test.ts — 13 tests covering API key create/list/revoke/delete, validation, API key header auth behavior, and organization access control.

**Decisions:**
- Extracted app.ts from index.ts to avoid port binding during test imports. This is a standard pattern for supertest-based testing.
- Mounted /api/v1/api-keys route which existed as a route file but was never registered in the Express app.
- Used real JWT token generation (jsonwebtoken) with the same secrets as the mocked config, rather than mocking JWT utilities, to exercise the real auth middleware chain.
- Mocked Prisma at the database level but let all middleware (auth, validation, error handling, rate limiting) run for real.
- Set rate limit max to 10000 in test config to avoid interference during rapid test execution.

**Open questions:**
- None

**Status:** completed

---

## 00:00 — Security audit cleanup and .env.example update

**Task:** Fix remaining MEDIUM/LOW security audit findings and complete .env.example

**Changes:**
- .env.example — Added missing env vars: NODE_ENV, PORT, DATABASE_URL, REDIS_PASSWORD, RATE_LIMIT_WINDOW_MS, RATE_LIMIT_MAX_REQUESTS. Added comments explaining each variable and production caveats.
- backend/src/utils/pagination.ts — New utility: `parsePageInt()` for safe query-string integer parsing with NaN protection.
- backend/src/controllers/contacts.ts — Replaced raw `parseInt` with `parsePageInt` for pagination params.
- backend/src/controllers/companies.ts — Same parseInt cleanup.
- backend/src/controllers/deals.ts — Same parseInt cleanup.
- backend/src/controllers/activities.ts — Same parseInt cleanup.
- backend/src/controllers/signals.ts — Same parseInt cleanup; replaced `tier as any` with validated `ScoreTier` enum cast.
- backend/src/controllers/custom-objects.ts — Same parseInt cleanup.
- backend/src/services/deals.ts — Replaced `stage as any` with validated `DealStage` enum cast.
- backend/src/services/activities.ts — Replaced `type as any` and `status as any` with validated `ActivityType` / `ActivityStatus` enum casts.
- backend/src/services/account-scores.ts — Replaced `factors as any` with `Prisma.InputJsonValue` cast.
- backend/src/services/webhooks.ts — Replaced `payload as any` with `Prisma.InputJsonValue` cast.
- backend/src/middleware/api-key-auth.ts — Removed all `(req as any)` casts by extending Express Request type.
- backend/src/types/express.d.ts — Added `apiKeyAuth` and `apiKeyScopes` to Express Request interface.
- backend/src/utils/logger.ts — Production now outputs structured JSON; dev keeps colorized human-readable output.
- backend/src/controllers/auth.ts — Added refresh token reuse detection: when a rotated token is replayed, all sessions for that user are invalidated and a security warning is logged.

**Decisions:**
- Used a shared `parsePageInt` utility instead of inline NaN guards to reduce duplication across 6 controllers.
- For enum filter params (DealStage, ActivityType, etc.), added validation sets so invalid enum values are silently ignored rather than passed to Prisma (which would throw).
- For Prisma Json fields, used `as unknown as Prisma.InputJsonValue` instead of `as any` to maintain type safety while satisfying the Json column constraint.
- Refresh token reuse detection uses the single-token-per-user model: if a previously rotated token is presented (valid JWT, wrong hash), all sessions are nuked. No schema migration needed.

**Status:** completed

---

## 19:30 — Market Research + Production Audit

**Task:** Competitive analysis, pricing strategy, and full production-readiness audit

**Research summary:**
- Attio ($59/user/mo) closest competitor — zero signal engine or PQA scoring
- PLG overlays (Pocus, Correlated) require separate CRM + data warehouse underneath
- Calixa shut down Jan 2024 — validates overlay-only model is not viable
- Our moat: first CRM combining API-first + native signal ingest + PQA scoring in one product
- Pricing: Free (3 users, 1k signals) → Pro $49/user/mo → Scale $99/user/mo → Enterprise
- Node.js SDK is #1 missing piece for developer adoption
- Target: Series A-C devtool companies (Resend, Railway, Neon, Trigger.dev, Inngest, Clerk, WorkOS)

**Audit summary (26 items found):**
- 7 P0 (must fix), 9 P1 (should fix), 10 P2 (nice to have)
- Full details in agent logs

**Status:** completed

---

## 19:30 — P0 Sprint Complete (4 parallel agents)

**Task:** Execute all P0 blockers from the production audit in one parallel sprint.

**Changes (Agent 1: Backend Infrastructure):**
- backend/src/index.ts — Async startup: `await setupGraphQL(app)` before `app.listen()`. Graceful shutdown on SIGTERM/SIGINT with `server.close()` + `prisma.$disconnect()`.
- backend/src/app.ts — Health check now pings DB with `prisma.$queryRaw\`SELECT 1\``. Returns 503 with `db: 'disconnected'` on failure.

**Changes (Agent 2: Error Handling + Org CRUD):**
- backend/src/utils/errors.ts — New AppError class with statusCode + isOperational
- backend/src/middleware/error.ts — AppError instanceof check before 500 fallback
- 7 service files — All `throw new Error` replaced with `throw new AppError(msg, statusCode)` (404/409/400)
- backend/src/services/organizations.ts — New CRUD: create (+ OWNER membership), list, get, update (OWNER/ADMIN only)
- backend/src/controllers/organizations.ts — Express controller
- backend/src/routes/organizations.ts — POST/GET/GET/:id/PUT/:id with Zod validation
- backend/src/app.ts — Mounted at /api/v1/organizations

**Changes (Agent 3: Performance + Docker):**
- backend/src/services/signals.ts — Batch ingest rewritten with `prisma.$transaction` for atomic writes
- docker-compose.yml — Redis 7 Alpine with AOF, healthcheck, backend depends_on
- backend/prisma/schema.prisma — 8 composite indexes across Contact, Company, Deal, Activity, Signal

**Changes (Agent 4: Signal Validation + Frontend Env):**
- backend/src/routes/signals.ts — Improved Zod validation messages on ingest schemas
- frontend/src/lib/api.ts — Uses `import.meta.env.VITE_API_URL` for configurable API base
- frontend/.env.example — Documents VITE_API_URL
- frontend/tsconfig.json — Added vite/client types

**Fixes (post-agent verification):**
- 3 integration tests updated: delete-not-found assertions changed from 500 to 404 (correct after AppError)

**Tests:** 203/203 passing, frontend tsc clean

**Status:** completed

---

## 21:30 — P1 Sprint Complete (4 parallel agents)

**Task:** Execute all P1 Beta Readiness items in one parallel sprint.

**Changes (Agent 1: Prisma Migration + DataLoader):**
- backend/prisma/migrations/20260212000000_add_composite_indexes/migration.sql — 18 CREATE INDEX statements for all composite indexes
- backend/prisma/migrations/migration_lock.toml — PostgreSQL migration lock
- backend/src/graphql/dataloader.ts — New file. DataLoader factory with 11 typed loaders: contactsByCompanyId, dealsByCompanyId, signalsByAccountId, signalsByActorId, scoreByAccountId, briefByAccountId, companyById, contactById, userById, identitiesByContactId, signalSourceById
- backend/src/graphql/resolvers.ts — All 14 field resolvers updated to use ctx.loaders instead of direct Prisma calls
- backend/src/graphql/index.ts — Creates fresh DataLoaders per request in GraphQL context
- backend/package.json — Added dataloader dependency

**Changes (Agent 2: Node.js SDK):**
- packages/sdk/ — Complete @devsignal/node TypeScript SDK (12 files)
- packages/sdk/src/client.ts — HTTP client using native fetch, Bearer + API key auth
- packages/sdk/src/types.ts — All entity types, input types, query params, response wrappers
- packages/sdk/src/errors.ts — DevSignalError class with status + code
- packages/sdk/src/resources/signals.ts — ingest, ingestBatch, list, getAccountSignals, getTimeline
- packages/sdk/src/resources/contacts.ts — CRUD (list, get, create, update, delete)
- packages/sdk/src/resources/companies.ts — CRUD
- packages/sdk/src/resources/deals.ts — CRUD
- packages/sdk/src/resources/scores.ts — getScore, computeScore, topAccounts
- packages/sdk/src/index.ts — DevSignal client class wiring all resources
- packages/sdk/README.md — Usage documentation with examples

**Changes (Agent 3: Signal Feed + PQA Dashboard):**
- frontend/src/pages/Signals.tsx — Signal feed with type/date/account filters, colored badges, expandable metadata, relative timestamps, pagination
- frontend/src/pages/PQADashboard.tsx — 4 summary cards (total, HOT, avg score, trending up), top accounts table with expandable factors, tier distribution bar chart, trend summary
- frontend/src/types/index.ts — Added Signal, AccountScore, ScoreTier, ScoreTrend, TIER_COLORS, TREND_ICONS types
- frontend/src/components/Layout.tsx — Added Signals + PQA Scores nav items with icons
- frontend/src/App.tsx — Added /signals and /scores routes

**Changes (Agent 4: Onboarding Flow):**
- frontend/src/pages/Onboarding.tsx — 4-step setup wizard: create org, invite team (coming soon), connect signal source (coming soon), completion screen
- frontend/src/components/GettingStarted.tsx — Persistent dashboard checklist (6 items, progress bar, dismissible, checks API for completion)
- frontend/src/pages/Dashboard.tsx — Renders GettingStarted at top
- frontend/src/lib/auth.tsx — Added refreshUser() method to re-fetch /auth/me after org creation
- frontend/src/App.tsx — Added RequireOrg wrapper, /onboarding route, redirects users without org to onboarding

**Verification:**
- Backend TypeScript: clean
- Frontend TypeScript: clean
- SDK TypeScript: clean
- Backend tests: 203/203 passing (16 suites)

**Status:** completed

---

## Next Steps (pick up here)

### P2 — Growth Features
- GitHub webhook receiver connector (auto-ingest GitHub events)
- Slack alerts on PQA tier changes (Hot → Warm → Cold notifications)
- CSV import for contacts/companies
- Real-time WebSocket updates for deal pipeline
- Full-text search with PostgreSQL tsvector

### Go-to-Market
- Landing page (devsignal.dev)
- Blog: "Why Your CRM Doesn't Understand PLG"
- Warm outreach to devtool DevRel leads
- Show HN launch
