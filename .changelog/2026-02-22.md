## 18:30 -- Add Signal Pattern Clustering and ICP Matching feature

**Task:** Build ICP (Ideal Customer Profile) matching, lookalike detection, and signal sequence analysis as a new feature.

**Changes:**
- backend/src/services/signal-patterns.ts -- New service with buildSignalProfile, findLookalikes, matchICP, detectSignalSequences, and ICP CRUD (stored in org settings JSON)
- backend/src/routes/signal-patterns.ts -- Seven REST endpoints for profiles, lookalikes, ICP CRUD, ICP matching, and signal sequences
- backend/src/app.ts -- Register /api/v1/patterns route
- frontend/src/pages/SignalPatterns.tsx -- Full page with ICP Builder form, ICP match results table, and Signal Sequences visualization
- frontend/src/App.tsx -- Register /patterns route with lazy loading
- frontend/src/components/Layout.tsx -- Add "Signal Patterns" nav item under INTELLIGENCE section with icon

**Decisions:**
- Stored ICP definitions in organization.settings JSON field to avoid new Prisma model/migration
- Used cosine similarity on signal-type distribution vectors for lookalike matching with bonus for industry (+0.1) and size (+0.05)
- Engagement classification: accelerating (7d > 1.2x 30d avg), decelerating (7d < 0.5x 30d avg), dormant (0 signals in 14d), steady (otherwise)
- Signal sequences limited to 2-grams and 3-grams from accounts with PQA score >= 70
- Batch processing (50 at a time) to avoid excessive DB load on large orgs

**Status:** completed

---

## 14:00 -- Wire auto-merge for high-confidence identity matches at signal ingestion

**Task:** Activate the unused AUTO_MERGE_THRESHOLD (0.8) so that high-confidence identity duplicates are merged automatically during signal ingestion, eliminating manual merge toil.

**Changes:**
- backend/src/services/identity-resolution.ts -- Added `autoMergeIfHighConfidence()` function with full safety checks: 24h in-memory cooldown per pair, sole-contact-in-company guard, 3+ overlap flags for manual review, signal-count-based primary selection. Added `recordAutoMerge()` to persist merge history in org.settings.autoMergeHistory (capped at 100 FIFO). Added `getAutoMergeStats()` for querying merge totals and recent merges. Imported `notifyOrgUsers` from notifications service for org-wide auto-merge alerts.
- backend/src/services/signals.ts -- Hooked `autoMergeIfHighConfidence()` as fire-and-forget after both single and batch signal ingestion. Hoisted `resolvedList` out of the Prisma transaction callback so it's accessible for the post-transaction auto-merge loop. Extracts email/github/npm metadata from signal data for merge identity matching.
- backend/src/routes/identity.ts -- Added `GET /api/v1/identity/auto-merge-stats` endpoint (MEMBER+) returning totalAutoMerges, last24h count, and up to 20 recent merge records.

**Decisions:**
- Used in-memory Map for cooldown instead of Redis because auto-merge is best-effort and per-instance cooldown is sufficient; avoids adding Redis coupling for a non-critical path
- Hoisted identity resolution out of the Prisma transaction in batch ingestion; this was already labeled "pre-resolve" in the original code but was incorrectly inside the transaction callback
- Auto-merge notifications go to all org users via `notifyOrgUsers()` so admins see what happened without needing to check logs
- Capped merge history at 100 entries to prevent org settings JSON from growing unboundedly

**Open questions:**
- Consider adding a per-org toggle to disable auto-merge (org.settings.autoMergeEnabled) if customers want full manual control
- May want to surface auto-merge history in the frontend identity resolution dashboard

**Status:** completed
