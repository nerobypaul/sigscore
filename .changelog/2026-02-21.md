# Changelog — 2026-02-21

## 00:15 — GraphQL security hardening (Show HN DoS protection)

**Task:** Fix GraphQL DoS vectors identified by security audit

**Changes:**
- backend/src/graphql/index.ts — Add custom query depth limiting rule (max depth 5) to prevent exponential nested queries; disable introspection in production to prevent schema enumeration
- backend/src/middleware/rate-limit.ts — Add dedicated graphqlLimiter (30 req/min) to prevent batch query abuse
- backend/src/app.ts — Mount graphqlLimiter on /api/v1/graphql; fix demo rate limit comment (was "3 req/min", actual is 10)

**Decisions:**
- Wrote custom depth limit rule inline instead of adding graphql-depth-limit dependency (zero new deps)
- Set depth limit to 5 — enough for accounts→contacts→company→signals→source but blocks deeper abuse
- GraphQL rate limit at 30 req/min — stricter than general API (100/min) since each request can batch multiple queries
- Kept demo limit at 10 req/min (not 3) — reasonable for Show HN traffic surge

**Status:** completed

## 01:00 — Rate limit UX + conversion funnel + dead code cleanup

**Task:** Add 429 toast handling, improve demo-to-signup conversion, remove unused packages, fix OIDC claim validation

**Changes:**
- frontend/src/lib/api.ts — Dispatch devsignal:rate-limited custom event on HTTP 429 responses
- frontend/src/components/Layout.tsx — Listen for rate-limited events, show debounced info toast (10s cooldown)
- frontend/src/pages/Pricing.tsx — All CTAs now pass ?plan=free|pro|growth|scale to Register page; usage estimator CTA passes recommended plan
- frontend/src/pages/Register.tsx — Show contextual banner for plan pre-selection and "from demo" welcome message
- frontend/src/components/DemoModeBanner.tsx — CTAs pass ?from=demo; secondary CTA changed from "Connect GitHub" to "See Pricing"
- frontend/src/components/DemoOnboardingHints.tsx — Final CTA passes ?from=demo
- backend/package.json — Removed 7 unused packages (passport, passport-github2, passport-google-oauth20, crypto-random-string, @types/passport, @types/passport-github2, @types/passport-google-oauth20)
- backend/src/types/express.d.ts — Added user?: User to Express.Request (was implicitly provided by @types/passport)
- backend/src/services/sso.ts — Add OIDC ID token claim validation: issuer, audience, expiry checks

**Decisions:**
- Rate limit toast uses CustomEvent pattern (same as 402 plan-limit handler) to communicate from axios interceptor to React context
- Kept 10-second debounce on rate limit toasts to avoid spamming
- Pre-selected plan is informational only (no billing integration yet — blocked on Stripe)
- OIDC claim validation added as defense-in-depth; PKCE already provides transport security. Full JWKS signature verification planned post-launch
- Passport packages confirmed unused: OAuth implemented via custom routes in backend/src/routes/oauth.ts

**Status:** completed
