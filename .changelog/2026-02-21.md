# Changelog — 2026-02-21

## 00:15 — GraphQL security hardening (Show HN DoS protection)

**Task:** Fix GraphQL DoS vectors identified by security audit

**Changes:**
- backend/src/graphql/index.ts — Add custom query depth limiting rule (max depth 5) to prevent exponential nested queries; disable introspection in production to prevent schema enumeration
- backend/src/middleware/rate-limit.ts — Add dedicated graphqlLimiter (30 req/min) to prevent batch query abuse
- backend/src/app.ts — Mount graphqlLimiter on /api/v1/graphql; fix demo rate limit comment (was "3 req/min", actual is 10)

**Decisions:**
- Wrote custom depth limit rule inline instead of adding graphql-depth-limit dependency (zero new deps)
- Set depth limit to 5 — enough for accounts→contacts→company→signals→source but blocks deeper abuse
- GraphQL rate limit at 30 req/min — stricter than general API (100/min) since each request can batch multiple queries
- Kept demo limit at 10 req/min (not 3) — reasonable for Show HN traffic surge

**Status:** completed

## 01:00 — Rate limit UX + conversion funnel + dead code cleanup

**Task:** Add 429 toast handling, improve demo-to-signup conversion, remove unused packages, fix OIDC claim validation

**Changes:**
- frontend/src/lib/api.ts — Dispatch devsignal:rate-limited custom event on HTTP 429 responses
- frontend/src/components/Layout.tsx — Listen for rate-limited events, show debounced info toast (10s cooldown)
- frontend/src/pages/Pricing.tsx — All CTAs now pass ?plan=free|pro|growth|scale to Register page; usage estimator CTA passes recommended plan
- frontend/src/pages/Register.tsx — Show contextual banner for plan pre-selection and "from demo" welcome message
- frontend/src/components/DemoModeBanner.tsx — CTAs pass ?from=demo; secondary CTA changed from "Connect GitHub" to "See Pricing"
- frontend/src/components/DemoOnboardingHints.tsx — Final CTA passes ?from=demo
- backend/package.json — Removed 7 unused packages (passport, passport-github2, passport-google-oauth20, crypto-random-string, @types/passport, @types/passport-github2, @types/passport-google-oauth20)
- backend/src/types/express.d.ts — Added user?: User to Express.Request (was implicitly provided by @types/passport)
- backend/src/services/sso.ts — Add OIDC ID token claim validation: issuer, audience, expiry checks

**Decisions:**
- Rate limit toast uses CustomEvent pattern (same as 402 plan-limit handler) to communicate from axios interceptor to React context
- Kept 10-second debounce on rate limit toasts to avoid spamming
- Pre-selected plan is informational only (no billing integration yet — blocked on Stripe)
- OIDC claim validation added as defense-in-depth; PKCE already provides transport security. Full JWKS signature verification planned post-launch
- Passport packages confirmed unused: OAuth implemented via custom routes in backend/src/routes/oauth.ts

**Status:** completed

## 02:00 — Landing page polish + Sentry lazy-load + performance audit

**Task:** Polish demo UX on landing page, lazy-load Sentry, act on performance and N+1 audit results

**Changes:**
- frontend/src/pages/Landing.tsx — Add "No signup needed" hint below hero CTAs; add retry button on demo failure; show specific 429 error message
- frontend/src/lib/sentry.ts — Dynamic import() of @sentry/react only when VITE_SENTRY_DSN is set; removed unused captureException and SentryErrorBoundary exports

**Audit results (no action needed — already optimized):**
- Frontend bundle: 91KB gzipped, 12.92KB CSS — excellent for Show HN
- 58 pages 100% lazy-loaded with React.lazy
- System fonts (no web font overhead)
- Auth provider has fast-path: skips /auth/me when no token (all Show HN traffic)
- Dashboard widgets: already use batch lookups with Maps (no N+1)
- Signal/score services: already use Promise.all parallelization

**Open questions:**
- Export endpoints (contacts, companies) have nested tag includes — N+1 at 10K+ scale but not critical for Show HN demo traffic
- og-image.png is 335KB PNG — could convert to WebP post-launch for faster social previews

**Status:** completed

## 03:00 — Auth hardening + error feedback for Show HN traffic

**Task:** Fix auth edge cases that would cause bad UX under high concurrent traffic (Show HN launch)

**Changes:**
- backend/src/controllers/auth.ts — Catch Prisma P2002 unique constraint on concurrent registration and return 400 (was uncaught → 500)
- frontend/src/lib/api.ts — Add return after token refresh failure to prevent stale state race condition in interceptor chain
- frontend/src/lib/auth.tsx — Only clear tokens on 401/403, not on transient 5xx/network errors (prevents silent logout under load)
- frontend/src/pages/Dashboard.tsx — Toast error when all 3 analytics chart endpoints fail
- frontend/src/pages/ContactDetail.tsx — Explicitly reset identity graph state on API failure
- frontend/src/pages/Contacts.tsx — Explicitly reset companies filter list on API failure

**Decisions:**
- Registration P2002 uses same generic error message as the normal duplicate check ("Unable to create account...") to avoid leaking email existence
- Auth provider now preserves session through transient errors — user stays logged in if /auth/me returns 500 or times out
- Dashboard only toasts on analytics when ALL 3 endpoints fail (partial failures silently degrade, which is better UX)
- Export endpoints confirmed NOT N+1 — Prisma `include` uses batched `IN` clauses, not per-row queries

**Status:** completed

## 04:00 — Fix 4 dashboard/landing data display bugs

**Task:** Fix endpoint and field name mismatches causing dashboard widgets to show empty data

**Changes:**
- frontend/src/pages/Dashboard.tsx — Fix Hot Accounts API call: `/signals/scores` → `/signals/accounts/top`, response field `scores` → `accounts` (widget was always empty)
- frontend/src/pages/Dashboard.tsx — Fix Top Signals chart: response field `types` → `signals` (chart was always empty)
- frontend/src/pages/Landing.tsx — Fix integration list: Zapier → Zendesk (matching actual backend integration sources)
- frontend/src/pages/Landing.tsx — Replace "47 companies discovered" metric with verified "12x cheaper than Common Room" (demo has 8 companies, claim was unverifiable)

**Decisions:**
- Fixed frontend to match backend API, not the other way around (backend endpoints are well-documented in Swagger)
- "12x cheaper" is a verified claim: Common Room starts at ~$1K/mo, DevSignal at $79/mo
- These bugs were only discovered via automated audit — manual testing of the demo dashboard would have shown the issue but the silent catch blocks masked them

**Status:** completed

## 05:00 — Demo UX polish + dead code cleanup

**Task:** Clean up dead fallback patterns, standardize demo detection, improve conversion CTA

**Changes:**
- frontend/src/pages/Signals.tsx — Remove dead `data.data` fallback (backend always returns `data.signals`)
- frontend/src/pages/SignalFeed.tsx — Remove 3 dead `data.data` fallbacks across fetch, load-more, and company dropdown
- frontend/src/pages/PQADashboard.tsx — Remove dead `data.data` fallback (backend returns `data.accounts`)
- frontend/src/pages/AccountReports.tsx — Remove dead `data.data` fallback (backend returns `data.companies`)
- frontend/src/components/DemoOnboardingHints.tsx — Improve final CTA: larger button (text-sm, py-2), better copy ("Start Free — No Credit Card"), fix org detection to use startsWith
- frontend/src/components/DemoModeBanner.tsx — Fix org detection: exact match to startsWith for robustness
- frontend/src/components/Layout.tsx — Fix org detection: exact match to startsWith for consistency
- frontend/src/pages/CompanyDetail.tsx — Fix 2 org detection instances: exact match to startsWith

**Decisions:**
- Standardized all 6 demo org detection sites to use `startsWith('DevSignal Demo')` — Dashboard.tsx already used this pattern, now consistent everywhere
- Dead `data.data` fallbacks were never reached since all backend endpoints return named response fields
- Verified DashboardBuilder's `data.data || data` is NOT dead code — backend wraps widget data in `{ data }` wrapper

**Status:** completed

## 05:30 — Fix OAuth route mismatch + pricing conversion + plan banner

**Task:** Fix launch-blocking OAuth 404 bug, add per-tier pricing CTAs, fix plan banner visibility

**Changes:**
- backend/src/app.ts — Fix OAuth route mount: `/api/v1` to `/api/v1/oauth` to match frontend link paths (GitHub/Google OAuth buttons were pointing to 404 routes)
- .env.example — Update callback URL comments to match new OAuth mount path
- frontend/src/pages/Landing.tsx — Add per-tier CTA buttons to pricing cards ("Start Free", "Get Pro", "Get Growth", "Get Scale") linking to /register?plan=
- frontend/src/pages/Register.tsx — Fix plan banner hidden when ?from=demo also present; now shows merged context for both params

**Decisions:**
- Changed backend mount point rather than frontend links — `/api/v1/oauth/github` is the more RESTful path
- Per-tier pricing CTAs use highlight styling for Pro (indigo, "Most Popular") and subtle gray for others
- Verified demo seed actually generates 600 signals (MEMORY.md said ~395 — that was outdated)

**Status:** completed

## 06:00 — Production polish: silent catch fixes, Zod validation, CTA mismatch

**Task:** Fix 4 remaining issues from comprehensive 40-agent audit sweep

**Changes:**
- frontend/src/components/DemoModeBanner.tsx — Fix secondary CTA: "See Pricing" was linking to /register?from=demo instead of /pricing; removed unnecessary clearDemoTokens onClick from pricing link
- frontend/src/pages/ContactDetail.tsx — Add toast.error feedback on identity graph API failure (was silently swallowing with no user feedback)
- frontend/src/pages/Contacts.tsx — Document intentional silent catch on companies filter dropdown (non-blocking — page still usable without filter)
- backend/src/routes/github-onboarding.ts — Add Zod validation (reposSchema) to POST /github/repos endpoint; was using manual if-check while /github/connect already used validate() middleware
- frontend/src/components/ErrorBoundary.tsx — Guard console.error with import.meta.env.DEV check (was leaking stack traces in production devtools)
- frontend/README.md — Fix inaccurate tech stack listing (removed TanStack Query, which is not used)

**Decisions:**
- Contacts filter dropdown silent catch is intentional — if companies API fails, the filter just doesn't populate but the page remains fully functional
- DemoModeBanner pricing link doesn't need clearDemoTokens — user just wants to see pricing, not start registration
- Used consistent Zod validation pattern (validate middleware) across all POST routes in github-onboarding

**Status:** completed

## 07:00 — Demo seed + empty state quality improvements

**Task:** Expand demo seed to all 16 signal sources, fix fabricated brief claims, improve loading/error states

**Changes:**
- backend/src/services/demo-seed.ts — Create all 16 SignalSource records (was only 6): added PyPI, Twitter/X, Stack Overflow, Reddit, PostHog, LinkedIn, Intercom, Zendesk, Website, Docs
- backend/src/services/demo-seed.ts — Map signal templates to correct sources: pypi_download→PyPI, twitter_mention→Twitter, stackoverflow_question→StackOverflow, reddit_discussion→Reddit, etc.
- backend/src/services/demo-seed.ts — Add 4 new signal types: posthog_event, linkedin_view, intercom_conversation, zendesk_ticket
- backend/src/services/demo-seed.ts — Remove fabricated competitive intelligence from briefs (Reddit thread quotes, Common Room pricing claims, "internal Slack leak")
- backend/src/services/demo-seed.ts — Add AI briefs for DataPipe Labs and Synthwave AI (5 of 8 companies now have briefs)
- backend/src/services/demo-seed.ts — Remove duplicate aiBrief from Acme's customFields (already in accountBrief table)
- backend/src/services/demo-seed.ts — Rename "Community Signals" source to "Zapier Webhooks" (matches product messaging)
- backend/src/services/demo-seed.ts — Replace generic usernames (dev_user, tech_lead) with realistic handles (sarahdev_, devops_weekly)
- frontend/src/pages/AccountReports.tsx — Replace text-only loading with Spinner component; add retry button on error
- frontend/src/pages/WebhookManager.tsx — Replace text-only loading with Spinner component; add retry button on error
- frontend/src/pages/DashboardBuilder.tsx — Improve bare "No data" text to "No data available" with consistent centering

**Decisions:**
- Added briefs for top 5 companies only (HOT + WARM tier). Cold-tier companies having no brief is realistic — not worth AI compute on inactive accounts
- Competitive intelligence sections rewritten to use defensible language ("no competing tools detected", "browsing patterns suggest price comparison") instead of fabricated quotes
- PQADashboard already had toast.error in catch block — audit finding was incorrect
- Page_view signal moved from PRODUCT_API source to WEBSITE source (more accurate categorization)
- Docs_read signal moved from PRODUCT_API to DOCS source

**Status:** completed

## 08:00 — Security: sanitize 38 connector error messages + Signals UX fix

**Task:** Fix information disclosure vulnerability across 8 connector files; add "Clear filters" CTA to Signals page

**Changes:**
- backend/src/routes/discord-connector.ts — Sanitize 7 catch blocks: stop passing err.message to response; fix "Missing guild_id" → "Invalid Discord server configuration"
- backend/src/routes/stackoverflow-connector.ts — Sanitize 4 catch blocks
- backend/src/routes/twitter-connector.ts — Sanitize 4 catch blocks
- backend/src/routes/reddit-connector.ts — Sanitize 4 catch blocks
- backend/src/routes/posthog-connector.ts — Sanitize 5 catch blocks (including removal of message-based 404 conditional)
- backend/src/routes/linkedin-connector.ts — Sanitize 6 catch blocks
- backend/src/routes/intercom-connector.ts — Sanitize 5 catch blocks
- backend/src/routes/zendesk-connector.ts — Sanitize 5 catch blocks
- frontend/src/pages/Signals.tsx — Add "Clear filters" link in filter empty state (matching SignalFeed.tsx UX)

**Decisions:**
- Removed `const message = err instanceof Error ? err.message : ...` pattern entirely from all connector catch blocks
- All catch blocks now return static fallback strings instead of raw exception messages
- logger.error() preserved in all catch blocks — full error details still available in server logs
- PostHog's conditional 404 based on message content removed (unreliable pattern)

**Status:** completed

## 09:00 — Password reset hardening + search empty state polish

**Task:** Fix password reset error message to use fixed string; add search icons to filter empty states

**Changes:**
- backend/src/controllers/auth.ts — Replace `error.message` with fixed user-friendly string for password reset errors (defense-in-depth against timing side-channel)
- frontend/src/pages/Companies.tsx — Add search magnifying glass icon to "No companies match" empty state
- frontend/src/pages/Contacts.tsx — Add search magnifying glass icon to "No contacts match" empty state

**Status:** completed

## 10:00 — Demo first-impression UX: Hot Accounts above fold + onboarding reposition

**Task:** Optimize the first 30 seconds of the demo experience for Show HN visitors

**Changes:**
- frontend/src/pages/Dashboard.tsx — Move "Hot Accounts Spotlight" hero card ABOVE DailyDigest (was below fold on 1366x768 laptops); add hover scale animation and enhanced shadow transition
- frontend/src/components/DemoOnboardingHints.tsx — Reposition from bottom-right to bottom-left to avoid blocking the "View All Scores" CTA on the hero card

**Decisions:**
- Hot Accounts above fold is the "wow" moment — a YC founder should see scored accounts immediately, not after scrolling
- Bottom-left position for onboarding hints avoids overlapping the hot accounts card CTA while keeping it visible
- Added subtle scale(1.01) hover to make the hero card feel interactive without being distracting

**Status:** completed

## 10:30 — DashboardSkeleton hero placeholder for smooth layout shift

**Task:** Add hero card placeholder to DashboardSkeleton to prevent layout shift when data loads

**Changes:**
- frontend/src/components/Spinner.tsx — Add gradient hero card placeholder (matching Hot Accounts Spotlight dimensions) with 3-column sub-cards to DashboardSkeleton; uses semi-transparent indigo/purple gradient to preview the hero card shape

**Status:** completed
