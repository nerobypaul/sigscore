# Changelog — 2026-02-20

## 13:00 — Fix concurrent token refresh race + demo seed cascade delete

**Task:** Fix production demo seed 500 error and token rotation cascade that logged users out on multi-page navigation

**Changes:**
- frontend/src/lib/api.ts — Added shared refresh promise to prevent concurrent 401s from racing on the same refresh token. Multiple simultaneous 401s now queue behind a single refresh call instead of each consuming the token independently.
- frontend/src/pages/Signals.tsx — Fixed `account` query param to `accountId` (matching backend controller expectation)
- backend/prisma/schema.prisma — Added `onDelete: Cascade` to EmailSequence → Organization relation (the only org relation missing it)
- backend/prisma/schema.prisma — Added `onDelete: Cascade` to EmailEnrollment → EmailSequence, EmailEnrollment → Contact, EmailSend → EmailEnrollment, EmailSend → EmailSequenceStep
- backend/prisma/migrations/20260220140000_add_cascade_delete_email_sequences/migration.sql — Migration to alter FK constraints
- backend/tsconfig.json — Added `ts-node: { files: true }` so ts-node honors include globs and picks up `src/types/express.d.ts`

**Production verification:**
- Demo seed: now works (was returning 500 due to FK violation on org delete)
- Health: DB up, Redis up
- Contacts: 18, Signals: 395, PQA: 8 scored accounts, Deals: 3, Workflows: 2
- Migration applied on deploy via `prisma migrate deploy`

**Decisions:**
- Used shared promise pattern for refresh queue (simpler than mutex/semaphore, no added deps)
- Added cascades to entire email sequence chain (Sequence → Steps → Sends, Sequence → Enrollments → Sends) to prevent any future FK issues on org deletion

**Status:** completed

## 21:00 — Enrich demo seed for Show HN + full codebase audit

**Task:** Run comprehensive frontend/backend/demo audits, then enrich demo data for maximum Show HN impact

**Audit Results:**
- Frontend: 58 pages audited, 0 critical bugs, 1 high (console.error in Landing.tsx, fixed)
- Backend: 63 route files audited, 0 critical bugs, all auth properly enforced
- Demo: Data quality excellent, needed more signal volume and AI brief coverage

**Changes:**
- backend/src/services/demo-seed.ts — Increased signal count from 395 to 600 across all 8 companies
- backend/src/services/demo-seed.ts — Added AI briefs for NovaCLI and CloudForge (previously only Acme had one)
- backend/src/services/demo-seed.ts — Added Segment and Discord signal sources (6 total, up from 4)
- backend/src/services/demo-seed.ts — Added 7 new signal templates: segment_identify, segment_track, discord_join, discord_thread, docs_read, github_commit
- frontend/src/pages/Landing.tsx — Removed console.error from demo seed error handler

**Production verification:**
- Demo seed: 8 companies, 18 contacts, 600 signals, 3 deals, 2 workflows
- 3 AI briefs (Acme: expansion, NovaCLI: early adoption, CloudForge: competitive switch)
- PQA: 8 scored accounts with 14-day history
- All endpoints returning correct data

**Decisions:**
- Signal distribution kept proportional: HOT (210/130), WARM (95/65/45), COLD (25/18/12)
- AI briefs varied by narrative: expansion play, founder-friendly pricing, competitive displacement
- Added Segment + Discord sources to better showcase the "16 sources" promise

**Status:** completed
